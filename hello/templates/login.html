{% load staticfiles %}
<!DOCTYPE html>
<html>
    <head lang="en">
	    <meta charset="UTF-8">
      <title>Technex-Login</title>
      <meta name="google-signin-client_id" content="702913643852-qbsg8t4bvc06h57lbomh8th6uvbvhhbr.apps.googleusercontent.com">
      <script src="https://apis.google.com/js/platform.js" async defer></script>
    </head>
<body>
<form role="form" method="post" action= "/login/" id='post-form'>
    {% csrf_token %}
    <h1> Login </h1>
  <div>
	<input class="form-control" placeholder="Email" id="id_email" maxlength="255"  name="email" type="text" required autofocus=""/>
  <span id="email_error_msg"></span></div>
	<input type="password" class="form-control" placeholder="Password" id="id_password" name="password" required />
  <div id ='form_error_msg'></div>
  {% if response %}
  {{ response }}
  {% endif %}
  <br>
<button  type="submit" value="Submit" id="login_button"/>Sign in</button>
  <p> Not a member? <a href="{% url 'signup' %}"> SignUp! </a></p>
</form>
<div class="g-signin2" data-onsuccess="onSignIn"></div>
<a href="#" onclick="signOut();">Sign out</a>
<script>
  function signOut() {
    var auth2 = gapi.auth2.getAuthInstance();
    auth2.signOut().then(function () {
      console.log('User signed out.');
    });
  }
</script>
<script type="text/javascript">
  function createCookie(name,value){
    document.cookie = name+"="+value+";";
  }

  function onSignIn(googleUser) {
  var csrftoken = getCookie('csrftoken');
  var profile = googleUser.getBasicProfile();
  createCookie('ID', profile.getId());
  createCookie('name', profile.getName());
  createCookie('Image URL', profile.getImageUrl());
  createCookie('Email', profile.getEmail());
  $.ajax({
    url:"/idcheck/",
    type:"POST",
    dataType:"json",
    data: {
      id : profile.getId(),
      'csrfmiddlewaretoken': csrftoken
    },
    success : function(json) {
      if(json.response == "EXIST"){
        window.location = "/";
      }
      else {
        window.location = "/signup2";
      }
    },
    error : function(xhr,errmsg,err) {
        alert(xhr.status + ": " + xhr.responseText);
    }

  });
}

</script>
</body>
<script src="{% static "js/jquery.min.js" %}"> </script>
<script src="{% static "js/jquery-1.11.3.min.js" %}"> </script>
<script src="{% static "js/login-ajax.js" %}"> </script>
</html>
